/**
 * Â©2012 Airbnb, Inc.
 * infinity.js may be freely distributed under the terms of the BSD license.
 * For all licensing information, details, and documention:
 * http://airbnb.github.com/infinity
 */!function(e,t,n){"use strict";function l(e){e=e||{},this.$el=C(),e.className&&this.$el.addClass(e.className),e.id&&this.$el.attr("id",e.id),this.lazy=!!e.lazy,this.lazyFn=e.lazy||null,c(this),this.top=0,this.width=0,this.height=0,this.pages=[],this.startIndex=0,w.attach(this)}function c(e){e._$buffer=k().prependTo(e.$el)}function h(e){var t,n=e.pages,r=e._$buffer;n.length>0?(t=n[e.startIndex],r.height(t.top)):r.height(0)}function p(e,t){t.$el.remove(),e.$el.append(t.$el),N(t,e.height),t.$el.remove()}function d(e,t){var n,r,i,s=!1,o=!0;for(n=0,r=t.length;n<r;n++)i=t[n],s&&i.onscreen&&(o=!1),o?i.onscreen||(s=!0,i.appendTo(e.$el)):(i.remove(),i.appendTo(e.$el))}function v(r){var i,s,o,u,f,l,c,p,v=r.startIndex,m=n(e).scrollTop(),g=n(e).height(),b=m+g,w=y(r,m,b);if(w<0||w===v)return v;u=r.pages,v=r.startIndex,f=new Array(u.length),l=[],c=t.min(v+a,u.length),p=t.min(w+a,u.length);for(i=w,s=p;i<s;i++)f[i]=!0,l.push(u[i]);for(i=v,s=c;i<s;i++)f[i]||u[i].remove();return r.startIndex=w,d(r,l),h(r),r.lazyload(),w}function m(e){return e instanceof T?e:(typeof e=="string"&&(e=n(e)),new T(e))}function g(e,t){}function y(e,n,r){var i=b(e,n,r);return i=t.max(i-u,0),i=t.min(i,e.pages.length),i}function b(e,t,n){var r,i,s,o=e.startIndex,u=e.pages;t-=e.top,n-=e.top;if(u.length<=0)return-1;s=u[o];if(s.top>n){for(r=o-1;r>=0;r--){s=u[r];if(s.bottom<t)return r===u.length-1?u.length-1:r+1;if(s.top<=n&&s.bottom>=t)return r}return 0}if(s.bottom<t){for(r=o+1,i=u.length;r<i;r++){s=u[r];if(s.top>n)return r===0?0:r-1;if(s.top<=n&&s.bottom>=t)return r}return u.length-1}return o}function E(){this.items=[],this.$el=k(),this.id=S(),this.$el.attr(s,this.id),this.top=0,this.bottom=0,this.width=0,this.height=0,this.lazyloaded=!1,this.onscreen=!1}function x(e,t){var n,r,i,s=this.items;for(n=0,r=s.length;n<r;n++)if(s[n]===e){i=n;break}return typeof i=="undefined"?!1:(s.splice(i,1),this.bottom-=e.height,this.height=this.bottom-this.top,this.hasVacancy()||g(this.parent,this),!0)}function T(e){this.$el=e,this.parent=null,this.top=0,this.bottom=0,this.width=0,this.height=0}function N(e,t){var n=e.$el,r=n.offset();e.top=t,e.height=n.outerHeight(!0),e.bottom=e.top+e.height,e.width=n.width()}function C(){return n("<div></div>")}function k(){return C().css({margin:0,padding:0,border:"none"})}function L(e){return parseInt(e.replace("px",""),10)}var r=e.infinity,i=e.infinity={},s="data-infinity-pageid",o=1.5,u=1,a=u*2+1,f=100;l.prototype.append=function(e){var n,r,i,s=m(e),o=this.pages,u=!1;p(this,s),this.height+=s.height,this.$el.height(this.height),o.length>0&&(n=o[o.length-1]);if(!n||!n.hasVacancy())n=new E,o.push(n),u=!0;n.append(s),r=v(this),i=t.min(r+a,o.length);for(r;r<i;r++)o[r].appendTo(this.$el);return s},l.prototype.prepend=function(e){var t,n=m(e),r=!1;return p(this,n),this.height+=n.height,n},l.prototype.appendTo=function(e){this.$el.appendTo(e),this.top=this.$el.offset().top},l.prototype.prependTo=function(e){this.$el.prependTo(e),this.top=this.$el.offset().top},l.prototype.remove=function(){this.$el.remove(),this.cleanup()},l.prototype.find=function(e){},l.prototype.at=function(e){},l.prototype.cleanup=function(){w.detach(this)},l.prototype.lazyload=function(){if(!this.lazy)return;var e=this.startIndex,n=this.pages,r=t.min(e+a,n.length);for(e;e<r;e++)n[e].lazyload(this.lazyFn)};var w=function(e,t){function s(){r||(setTimeout(o,f),r=!0)}function o(){var e,t;for(e=0,t=i.length;e<t;e++)v(i[e]);r=!1}var n=!1,r=!1,i=[];return{attach:function(r){n||(t(e).on("scroll",s),n=!0),i.push(r)},detach:function(r){var o,u;for(o=0,u=i.length;o<u;o++)if(i[o]===r)return i.splice(o,1),i.length===0&&(t(e).off("scroll",s),n=!1),!0;return!1}}}(e,n);E.prototype.append=function(e){var t=this.items;t.length===0&&(this.top=e.top),this.bottom=e.bottom,this.width=this.width>e.width?this.width:e.width,this.height=this.bottom-this.top,t.push(e),e.parent=this,this.$el.append(e.$el),this.lazyloaded=!1},E.prototype.prepend=function(e){var t=this.items;this.bottom+=e.height,this.width=this.width>e.width?this.width:e.width,this.height=this.bottom-this.top,t.push(e),e.parent=this,this.$el.prepend(e.$el),this.lazyloaded=!1},E.prototype.hasVacancy=function(){return this.height<n(e).height()*o},E.prototype.appendTo=function(e){this.onscreen||(this.$el.appendTo(e),this.onscreen=!0)},E.prototype.prependTo=function(e){this.onscreen||(this.$el.prependTo(e),this.onscreen=!0)},E.prototype.remove=function(){this.onscreen&&(this.$el.remove(),this.cleanup(),this.onscreen=!1)},E.prototype.cleanup=function(){},E.prototype.lazyload=function(e){this.lazyloaded||(e.call(this.$el[0]),this.lazyloaded=!0)};var S=function(){var e=0;return function(){return e++}}();T.prototype.remove=function(){this.$el.remove(),x(this,this.parent),this.cleanup()},T.prototype.cleanup=function(){this.parent=null},i.ListView=l,i.Page=E,i.ListItem=T,i.noConflict=function(){return e.infinity=r,i}}(window,Math,jQuery);